<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>V-Med ID | Login</title>
  <link rel="stylesheet" href="login.css" />
</head>
<body>

  <div class="login-container">

    <!-- Logo -->
    <img src="../../assets/images/logo.jpg" alt="V-Med ID Logo" class="logo" />

    <h2>Login to V-Med ID</h2>
    <p class="subtitle">Secure Virtual Medical Identity Access</p>

    <!-- Login Form -->
    <form id="loginForm">

      <!-- Role Selection (for UI clarity & safety check) -->
      <label for="role">Select Role</label>
      <select id="role" required>
        <option value="">-- Choose Role --</option>
        <option value="patient">Patient</option>
        <option value="doctor">Doctor</option>
        <option value="government">Government</option>
      </select>

      <!-- VMED ID -->
      <label for="userId">V-Med ID</label>
      <input
        type="text"
        id="userId"
        placeholder="VMED-p-name-123"
        required
      />

      <!-- Password -->
      <label for="password">Password</label>
      <input
        type="password"
        id="password"
        placeholder="Enter your password"
        required
      />

      <!-- Submit -->
      <button type="submit">Proceed to OTP</button>

    </form>

  </div>

  <!-- LOGIN LOGIC -->
  <script type="module">
    import { loginWithVMEDId } from "../../js/auth.js";

    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const selectedRole = document.getElementById("role").value;
      const vmedId = document.getElementById("userId").value.trim();
      const password = document.getElementById("password").value;

      if (!selectedRole) {
        alert("Please select a role.");
        return;
      }

      try {
        const result = await loginWithVMEDId(vmedId, password);

        // Optional safety check: role mismatch
        if (result.role !== selectedRole) {
          alert("Selected role does not match this V-Med ID.");
          return;
        }

        // Store role for OTP â†’ dashboard routing
        sessionStorage.setItem("role", result.role);

        // Go to OTP page
        window.location.href = "otp.html";

      } catch (error) {
        alert(error.message);
      }
    });
  </script>

</body>
</html>
